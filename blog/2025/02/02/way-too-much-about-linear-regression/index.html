<!DOCTYPE html>
<html>
<head>
    <title>Way too much about linear regression.</title>
    <meta charset='UTF-8'>
    <meta content='width=device-width, initial-scale=1' name='viewport'/>
    <meta name='description' content='Gregory Gundersen is a PhD candidate at Princeton.'>
    <meta name='keywords' content=''>
    <meta name='author' content='Gregory Gundersen'>
    
    <link href='/css/blog.css' rel='stylesheet'/>
    <link href='/css/trac.css' rel='stylesheet'/>
    <link href='/css/markdown.css' rel='stylesheet'/>
    
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "$", right: "$", display: false},
                    {left: "\\[", right: "\\]", display: true},
                    {left: "\\(", right: "\\)", display: false}
                ],
                throwOnError: false
            });
        });
    </script>
    
    <script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  jax: ['input/TeX', 'output/HTML-CSS'],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    extensions: ['color.js']
  },
  messageStyle: 'none',
  'HTML-CSS': { preferredFont: 'TeX', availableFonts: ['STIX','TeX'] }
});
</script>

<script src='//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML' type='text/javascript'></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
</head>
<body>
    <div class='content'>
        <div class='nav'>
    <ul class='wrap'>
        <li><a href='/'>Home</a></li>
        <li><a href='/blog'>Blog</a></li>
        <li><a href='/feed.xml'>RSS</a></li>
    </ul>
</div>
        <div class='front-matter'>
            <div class='wrap'>
                <h1>Way too much about linear regression.</h1>
                <h4>There's a lot of details</h4>
                <div class='bylines'>
                    <div class='byline'>
                        <h3>Published</h3>
                        <p>02 February 2025</p>
                    </div>
                </div>
                <div class='clear'></div>
            </div>
        </div>
        <div class='wrap article'>
            <ul><li><a href="#introduction">Introduction</a></li><li><a href="#an-algebraic-perspective">An algebraic perspective.</a></li><li><a href="#a-statistical-persective">A statistical persective.</a></li><li><a href="#projections">Projections</a><ul><li><a href="#how-do-i-find-a-projection-matrix-for-a-given-v">How do I find a projection matrix for a given $v$?</a></li></ul></li><li><a href="#linear-regression-as-a-projection">Linear Regression as a projection.</a><ul><li><a href="#geometric-interpretation">Geometric interpretation</a></li></ul></li><li><a href="#frisch-waugh-lovell">Frisch-Waugh-Lovell</a></li><li><a href="#putting-it-all-together">Putting it all together</a><ul><li><a href="#the-role-of-orthogonalization">The Role of Orthogonalization</a></li></ul></li></ul>
            <h1 id="introduction">Introduction</h1>
<p>There are a lot of ways to understand (multiple) linear regression, but it takes a lot of work to integrate them all together. This guide attempts to do that. It starts off deriving the solution to the linear regression problemâ€”how linear regression is the maximum likelihood solution for ordinary least squaresâ€”and then moves on to the Frisch-Waugh-Lovell theorem as a tool to understand how the perspectives all hang together.</p>

<h1 id="an-algebraic-perspective">An algebraic perspective.</h1>
<p>Suppose you have a set of observations of some process you wanted to model, for example the size of a house labelled as $x_i \in \mathbb{R}^n$, and the house price labeled as $y_i \in \mathbb{R}$, $i=1\ldots m$ (i.e. you have $m$ examples). One good choice for a model is linear:</p>

\[\hat{y}(x) = Ax + b\]

<p>The goal is to find some suitable $A \in \mathbb{R}^n$ and $b \in \mathbb{R}$, to model this process correctly.</p>

<p>For convenience, letâ€™s make some new definitions:</p>

\[\Theta = [A:b]\]

\[X = [x_1:\ldots:x_m:1]\]

\[Y = [y_1:\ldots:y_m:1]\]

<p>What weâ€™ve done here is to stack our parameters into $\Theta$ so that itâ€™s a $\mathbb{R}^{(n+1)\times 1}$ vector, we have stacked our examples into an $\mathbb{R}^{(n+1)\times m}$ matrix, and we have stacked all the outputs into a $\mathbb{R}^{(n+1)\times 1}$ vector. Now our hypothesis can be written as</p>

\[\hat{Y} = \Theta^T X\]

<p>Say you also had good reason to believe that the best reconstruction of $x$ you could possibly hope to achieve was to minimise the following (mean squared) error measure:</p>

\[J(\Theta) = \frac{1}{n}\|\hat{Y}-Y\|_2^2\]

<p>This is <strong>linear regression</strong>â€”the fundamental tool in statistical modeling. Itâ€™s the swiss army knife of statistical modeling, and using it can get you really far. Real-world applications often require more sophisticated approaches.</p>

<p>You can do some calculus and show that the closed-form solution for Ordinary Least Squares (OLS) regression with matrices of arbitrary size is:</p>

\[\beta = (X'X)^{-1}X'y\]

<p>However this solution is a little opaque. The solution defines a hyperplane in the feature space, but thatâ€™s no better than just staring at the solution. Itâ€™s difficult to interpret why this specific hyperplane has been chosen.</p>

<p>If you squint, you can make algebraic sense of the solution: pre-multiplying by $Xâ€™$ will give us $Xâ€™y = \beta Xâ€™X$ and then you have to â€˜divideâ€™ by the matrix $Xâ€™X$ to get the solution for $\beta$. But this is unsatisfactory: following some algebraic steps wonâ€™t tell you why this is the solution, and it wonâ€™t help in making generalisations (such as ridge regession or the Lasso) legible.</p>

<h1 id="a-statistical-persective">A statistical persective.</h1>

<p>In simple linear regression (with one independent variable and a constant term), you can do a little bit of different algebra to show that the coefficient $\beta$ can be expressed as:</p>

\[\beta = \frac{Cov(X, Y)}{Var(X)}\]

<p>This makes some more intuitive sense!</p>

<p>A linear regression coefficient tells us: If predictor variable ğ‘¥ increases by 1, what is the expected increase in outcome variable ğ‘¦?</p>

<p>The answer to this question depends in large part on the scales on which ğ‘¥ and ğ‘¦ are measured. E.g., if ğ‘¥ is a measure of length, imagine measuring in millimeters or centimeters; the variance of measurements in millimeters will be 102 times the variance of the same measurements in centimeters; the covariance will be multiplied by 10. Note, ğ‘ğ‘œğ‘£(ğ‘¥,ğ‘¦)</p>

<p>is determined by three things:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>the linear association between ğ‘¥
</code></pre></div></div>

<p>and ğ‘¦
;
the scale of ğ‘¥
;
the scale of ğ‘¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
</code></pre></div></div>

<p>Because of 2) and 3), I would call the covariance an unstandardized measure of association. Its value is difficult to interpret, because what would be a large and what would be a small value depends on the scales of ğ‘¥
and ğ‘¦. The correlation coefficient, however, gives us a standardized measure of association: It is â€˜correctedâ€™ for the scales on which ğ‘¥ and ğ‘¦</p>

<p>are measured:</p>

<p>ğ‘ğ‘œğ‘Ÿ(ğ‘¥,ğ‘¦)=ğ‘ğ‘œğ‘£(ğ‘¥,ğ‘¦)ğ‘£ğ‘ğ‘Ÿ(ğ‘¥)â‹…ğ‘£ğ‘ğ‘Ÿ(ğ‘¦)â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾âˆš</p>

<p>The correlation coefficient tells us: If ğ‘¥
increases by ğ‘£ğ‘ğ‘Ÿ(ğ‘¥)â€¾â€¾â€¾â€¾â€¾â€¾âˆš, how many ğ‘£ğ‘ğ‘Ÿ(ğ‘¦)â€¾â€¾â€¾â€¾â€¾â€¾âˆšs will outcome ğ‘¦ increase? Thus, with a correlation coefficient of 1, an increase of 1 SD in ğ‘¥ is associated with an increase of 1 SD in ğ‘¦</p>

<p>.</p>

<p>Now, the regression coefficient quantifies the expected increase in ğ‘¦
, when ğ‘¥ increases by 1. We thus need to â€˜correctâ€™ the covariance between ğ‘¥ and ğ‘¦ for the scale of ğ‘¥</p>

<p>. We can do that by simply dividing:</p>

<p>ğ‘ğ‘œğ‘£(ğ‘¥,ğ‘¦)ğ‘£ğ‘ğ‘Ÿ(ğ‘¥)</p>

<h1 id="projections">Projections</h1>

<p>A projection matrix $P$ is any matrix with property $P^2=P$. For vector $v$ in space and point $x$, projection $Px$ returns closest point $\bar{x}$ along $v$.</p>

<h2 id="how-do-i-find-a-projection-matrix-for-a-given-v">How do I find a projection matrix for a given $v$?</h2>

<p>Thatâ€™s not at all that helpful. Instead we want to find the projection matrix for a given $v#. To begin, we can take some point in $n$-dimensional space, $x$, and the vector line $v$ along which we want to project $x$. The goal is the following:</p>

<p>$\text{argmin}_c \sqrt{\sum_i(\bar{x}_i-x)^2} = \text{argmin}_c \sum_i(\bar{x}_i-x)^2 = \text{argmin}_c \sum_i(cv_i-x)^2$</p>

<p>This rearrangement follows since the square root is a monotonic transformation, such that the optimal choice of c is the same across both argminâ€™s. Since any potential Â¯x along the line drawn by v is some scalar multiplication of that line (cv), we can express the function to be minimised with respect to c, and then differentiate:</p>

<p>$\frac{d}{dc}\sum_i(cv_i-x)^2 = \sum_i 2v_i(cv_i-x) = 2(\sum_i cv_i^2 - \sum_i v_ix) = 2(cvâ€™v-vâ€™x) \Rightarrow 0$</p>

<p>$2(cvâ€™v-vâ€™x) = 0$
$cvâ€™v-vâ€™x = 0$
$cvâ€™v = vâ€™x$
$c = (vâ€™v)^{-1}vâ€™x$</p>

<p>So we end up with:</p>

<p>$P_v = v(vâ€™v)^{-1}vâ€™$</p>

<p>Which looks suspiciously similar to the formula for the optimal linear regression coefficients!</p>

<h1 id="linear-regression-as-a-projection">Linear Regression as a projection.</h1>

<p>Suppose we have a vector of outcomes $y \in \mathcal{R}^n$, and some $p$-dimensional matrix $X$ of predictors. We write the linear regression model as:</p>

<p>\(y=X^T\beta+Ïµ\) 
where Î² is a vector of coefficients, and Ïµ is additive Gaussian white noise. Linear regression minimises the sum of the squared residuals:</p>

\[\hat{y}=argmin_{\beta}(yâˆ’XÎ²)â€²(yâˆ’XÎ²)\]

<p>Differentiating with respect to and solving:</p>

<p>\(\begin{eqnarray}
\frac{d}{d\beta}(yâˆ’XÎ²)^T(yâˆ’XÎ²) &amp;=&amp; âˆ’2X(yâˆ’XÎ²) \\ 
&amp;=&amp; 2X^TXÎ²âˆ’2X^Ty \\
&amp;=&amp; 0 \\
&amp;\rightarrow \\
X^TXÎ² &amp;=&amp; X^Ty\\
\beta &amp;=&amp;(X^TX)^{âˆ’1}X^Ty.
\end{eqnarray}\)
To get our prediction of $y$, i.e. $\hat{y}$ , we multiply our $\beta$ coefficient by the matrix $X$:</p>

<p>\(\hat{y} = X\beta = X(X^TX)^{-1}X^Ty.\)
The OLS derivation of $\hat{y}$ is very similar to $P=X(X^TX)^{-1}X$, the orthogonal prediction matrix. The two differ only in that that $\hat{y}$ includes the original outcome vector $y$. But, $Py = X(X^TX)^{-1}X^Ty=\hat{y}$! Hence the predicted values from a linear regression simply are an orthogonal projection of $y$ onto the space defined by $X$</p>

<h2 id="geometric-interpretation">Geometric interpretation</h2>

<p>An alternative way to think about linear regression is by flipping our usual perspectiveâ€”instead of thinking of. Instead of thinking about each feature (X, Y) as dimensions and plotting data points as observations in this feature space, we can treat each observation as a dimension and view features as vectors in this observation-space.</p>

<p>As a concrete example we can think of houses for sale having a set of features (floorspace, rooms, location, sale price etc) and we record each houseâ€™s values of those features. Instead we can think of each house as a dimension, and represent each feature (floorspace, rooms, location, sale price) as a vector in this house-space.</p>

<p>if we had 100 houses in our dataset:</p>

<ul>
  <li>Rather than thinking of each house as a point in feature-space (e.g. plotting houses on axes of price vs. floorspace)</li>
  <li>Weâ€™d have a 100-dimensional space (one dimension per house)</li>
  <li>Each feature would be a vector in this 100-dimensional space</li>
  <li>The sale price vector would be some point in this space</li>
  <li>And linear regression would find the combination of feature vectors that gets closest to the sale price vector.</li>
</ul>

<p>In this dual space linear regression becomes a geometric problem where:</p>

<ul>
  <li>Your outcome variable Y is a vector pointing somewhere in this observation-space</li>
  <li>Your predictor variables (including a constant term) are also vectors</li>
  <li>The combinations of your predictor vectors create a â€œspanâ€ or â€œcolumn spaceâ€ - imagine this like a flat surface in the observation-space</li>
  <li>Linear regression finds the point on this surface thatâ€™s closest to your Y vector</li>
  <li>The regression coefficients are just the scaling factors you need to combine your predictor vectors to reach this closest point</li>
</ul>

<p>Linear regression is mathematically identical to an â€œorthogonal projectionâ€ - youâ€™re literally projecting your Y vector onto the surface defined by your predictors in the most direct (perpendicular) way possible.</p>

<p>While this might seem abstract, it helps explain why linear regression works the way it does - itâ€™s finding the best possible approximation of Y that can be created by combining your predictor variables, where â€œbestâ€ means â€œclosest in terms of Euclidean distance.â€</p>

<p><img src="/assets/images//LinearProjections/linear_projections.png" alt="Two views of linear regression" title="The two views of linear regression" /></p>

<h1 id="frisch-waugh-lovell">Frisch-Waugh-Lovell</h1>

<p>Any multiple linear regression is just a series of simple linear regressions in a trenchcoat.</p>

<p>This isnâ€™t so important today, where every researcher has access to a computer that can do the heavy lifting for them. Statisticians can spend more time thinking about what they put into regressions than how to do them. But back before there were computers, calculating regressions took a long time. There columns of numbers that you had to add up, and then you would have had to do some division as well. Knowing the details about the OLS model really sped up those hours with a slide rule and a table of logs.</p>

<p>A lot of the regressions statisticians and economists were concerned with involved panel data: observations of the same person over time. So one natural question you needed to ask, was:</p>

<ul>
  <li>Should I detrend each variable and then perform a regression on the detrended variables?</li>
</ul>

<p>Or</p>

<ul>
  <li>Add time as a variable to your model without detrending?</li>
</ul>

<p>The Frisch-Waugh-Lovell theorem says that these procedures are the same thing. In other words, time as a variable detrends the other parameters. The theorem is a version of the geometric intuition of [[Linear regression as a Projection]]: OLD projects $y$ onto the space spanned by the features $X$ to get the estimate $\hat{y}$.</p>

<p>Formally, FWL states that each predictorâ€™s coefficient in a multivariate regression explains that variance of $y$ not explained by both the other $k-1$ predictorsâ€™ relationship with the outcome and their relationship with that predictor, i.e.Â the independent effect of $x_j$.</p>

<p>The <a href="https://bookdown.org/ts_robinson1994/10EconometricTheorems/frisch.html">proof</a> is pretty boring and uses a the properties of projection matrices.</p>
<h1 id="putting-it-all-together">Putting it all together</h1>

<p>We had two questions earliner:</p>

<ol>
  <li>
    <p>The \frac{1}{N} \text{ Factor: Variance is typically calculated with a } \frac{1}{N} \text{ (or } \frac{1}{N-1}\text{) factor, while } Xâ€™X \text{ doesnâ€™t include this normalization. Why does our formula use } \text{Var}(x)\text{?}</p>
  </li>
  <li>
    <p>Mean Centering: Variance is calculated using centered values: \text{Var}(X) = \frac{1}{N} \sum(x-\bar{x})^2\text{, not just } \frac{1}{N} \sum x^2\text{. Where does this mean-centering come from?}
The first question has a satisfying answer: covariance also includes a 1/N factor! These factors cancel out in the ratio Cov(x,y)/Var(x), making it a convenient way to express the relationship.</p>
  </li>
</ol>

<p>The second question leads us to a deeper understanding of regressionâ€™s underlying mechanics.</p>

<h2 id="the-role-of-orthogonalization">The Role of Orthogonalization</h2>

<p>The mean-centering in variance calculations isnâ€™t arbitrary - itâ€™s a consequence of how OLS handles the constant term. OLS orthogonalizes effects with respect to each column vector in X.</p>

<p>To understand why orthogonalization matters, consider a simple example:
y = 3 + 4x + 5z</p>

<p>If we set x=1 and z=1, our predicted y is 12. Increasing z to 2 increases our prediction by exactly 5. This shows that âˆ‚y/âˆ‚z = 5, demonstrating the orthogonality of our coefficients. (If the variables werenâ€™t orthogonal, changing one variable would affect the contribution of others.)
The Constant Term and Orthogonalization</p>

<p>In simple regression, we have two columns:</p>

<ul>
  <li>A constant vector (all 1â€™s)</li>
  <li>Our independent variable x</li>
</ul>

<p>The coefficient $\beta$ must be orthogonalized with respect to the constant term. But what does orthogonality mean in this context?</p>

<p>\text{Two vectors are orthogonal if and only if their dot product is 0. For a constant vector } c=[1,1,1â€¦] \text{ and our } x \text{ vector } [x_1,x_2,x_3â€¦]\text{, their dot product is:}</p>

<p>x_1 + x_2 + x_3 â€¦</p>

<p>\text{To make this sum zero, we subtract the mean }(\bar{x})\text{ from each element:}</p>

<p>(x_1 - \bar{x}) + (x_2 - \bar{x}) + â€¦ = (x_1 + x_2 + â€¦) - \bar{x} * N = 0</p>

<p>\text{This reveals why we use centered values in variance calculations: centering a vector is equivalent to orthogonalizing it with respect to a constant term.}</p>

<p>\text{Now we can see how }(Xâ€™X)^{-1}\text{ relates to }\frac{1}{\text{Var}(x)}\text{. The mean-centering in variance calculations isnâ€™t just a statistical convention - itâ€™s a fundamental consequence of how regression handles the constant term through orthogonalization.}</p>

<p>\text{This helps explain why }\beta = \frac{\text{Cov}(x,y)}{\text{Var}(x)}\text{ works, and provides insight into the geometric foundations of linear regression.}</p>

        </div>
        
    </div>
</body>
</html>